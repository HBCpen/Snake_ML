# モデルへの入力について
## 基本的な考え方

AIの入力は、人間がゲーム画面を見て状況を判断するプロセスに似ています。AI、特にニューラルネットワーク（CNNなど）が得意なのは、画像のようなグリッド状のデータを処理することです。そこで、ゲームマップを複数の「チャンネル」を持つ画像データのように表現するのが最も効果的です。

---

## 具体的な入力データ

ゲームマップのサイズを `[幅, 高さ]` とします。入力データは主に2つの部分から構成されます。

### A. グリッドデータ (空間情報)

マップ上の各マスが何であるかを示す、`[幅, 高さ, チャンネル数]` の3次元配列（テンソル）を用意します。各チャンネルは特定の要素だけを表現します。

*   **チャンネル1: 餌 (Food)**
    *   餌があるマスを`1`、それ以外を`0`で表現します。
    *   理由: AIの第一目標である餌の位置を明確に伝えます。

*   **チャンネル2: 壁 (Walls)**
    *   壁があるマスを`1`、それ以外を`0`で表現します。
    *   理由: 衝突を避けるべき絶対的な障害物として認識させます。

*   **チャンネル3: 自分のスネークの頭 (My Head)**
    *   自分の頭があるマスを`1`、それ以外を`0`で表現します。
    *   理由: AI自身の現在位置を特定させます。

*   **チャンネル4: 自分のスネークの体 (My Body)**
    *   自分の体（頭以外）があるマスを`1`、それ以外を`0`で表現します。
    *   理由: 自分の体に衝突するのを防ぐために不可欠な情報です。

*   **チャンネル5: 相手のスネークの頭 (Opponent's Head)**
    *   相手の頭があるマスを`1`、それ以外を`0`で表現します。
    *   理由: 相手の次の動きを予測し、衝突を避けたり、相手の進路を妨害したりするための重要な情報です。

*   **チャンネル6: 相手のスネークの体 (Opponent's Body)**
    *   相手の体があるマスを`1`、それ以外を`0`で表現します。
    *   理由: 避けるべき障害物です。

**なぜチャンネルを分けるのか？**
全ての情報を1つの盤面（例: 壁=1, 餌=2, 自分の頭=3...）にまとめても学習は可能ですが、チャンネルを分けることで、畳み込みニューラルネットワーク(CNN)がそれぞれの特徴（「餌の特徴」「壁の特徴」など）を抽出しやすくなり、学習効率が格段に向上します。

### B. ベクトルデータ (非空間・補助情報)

グリッドデータだけでは表現しきれない、あるいは学習しにくい重要な情報を追加のベクトルとして与えます。

*   **自分と相手の長さ (Lengths)**
    *   例: `[自分の体の長さ, 相手の体の長さ]`
    *   理由: 長さはゲームの進行度を示し、戦略（守りに入るか、攻めるか）を変える要因になります。正規化（例: マップのマスの総数で割る）すると学習が安定します。

*   **自分と相手の進行方向 (Directions)**
    *   例: `[自分の進行方向, 相手の進行方向]` (それぞれ上下左右を0〜3やOne-hotベクトルで表現)
    *   理由: 静的な盤面だけでは、スネークがどちらに動いているかわかりません。進行方向が分かれば、次の瞬間に頭がどこに来るかを予測できます。特に、相手の頭が自分の進路に向かってきているかどうかの判断に不可欠です。

*   **最寄りの餌へのベクトル (Vector to nearest food)**
    *   例: `[x方向の差分, y方向の差分]`
    *   理由: グリッド情報からAIが自力で「最も近い餌はあっちだ」と学習するのは時間がかかります。この情報を直接与えることで、学習を大幅に高速化できます（特徴量エンジニアリング）。

---

## 発展的な考慮事項

より高度なAIを作るためには、以下の点も考慮に入れると良いでしょう。

*   **過去フレームの履歴 (Frame Stacking)**
    *   現在の盤面だけでなく、過去3〜4フレーム分のグリッドデータをまとめて入力します。
    *   **理由:** これにより、AIは静的な盤面だけでなく、「動き」や「速度」といった時間的な情報を捉えることができるようになります。相手がどちらの方向に動いているかをより正確に把握できるため、極めて有効です。

*   **自分中心の相対座標系 (Agent-Centric View)**
    *   常に自分の頭がマップの中央に来るように座標を回転・変換して入力します。
    *   **理由:** AIは「マップの左上にいる時」「右下にいる時」を別々の状況として学習する必要がなくなり、学習効率が向上します。

## まとめ

この2人対戦スネークAIの入力として最適なのは、以下の組み合わせです。

1.  **主要な入力 (必須):**
    *   **マルチチャンネル・グリッドデータ:** 餌、壁、自分と相手の頭・体をそれぞれ別のチャンネルで表現した盤面情報。

2.  **補助的な入力 (強く推奨):**
    *   **ベクトルデータ:** 自分と相手の長さ、進行方向などの数値情報。

3.  **高度化のための入力 (オプション):**
    *   **過去フレーム履歴:** 動きの情報を与えるために、過去数フレームをスタックする。

これらの情報を組み合わせることで、AIは「どこに目標（餌）があり、どこに危険（壁、自分や相手の体）があり、相手がどう動こうとしているか」を総合的に判断し、最適な次の一手を選択するための学習を進めることができます。